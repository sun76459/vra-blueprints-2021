formatVersion: 1
name: Ubuntu 18
version: 1.0.3
inputs:
  UseDeadnet:
    title: Use Dead Net?
    type: boolean
    default: false
resources:
  ubuntu:
    type: Cloud.vSphere.Machine
    properties:
      image: ubuntu
      flavor: Small
      constraints:
        - tag: 'env:vsphere'
      networks: '${map_by(resource.network_1[*] + resource.network_2[*],nic => {"network":nic.id, "assignment":"static", "deviceIndex":nic.deviceIndex})}'
  network_1:
    type: Cloud.vSphere.Network
    properties:
      count: 1
      networkType: existing
      constraints:
        - tag: 'net:existing'
        - tag: '!network-type:deadnet'
  network_2:
    type: Cloud.vSphere.Network
    properties:
      count: '${input.UseDeadnet? 1:0}'
      networkType: existing
      constraints:
        - tag: 'net:existing'
        - tag: 'network-type:deadnet'
